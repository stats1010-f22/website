{
  "hash": "bd4146ce16e82be706ca62583c767ae1",
  "result": {
    "markdown": "---\ntitle: \"Exploring categorical data AE-2\"\noutput: \n   html_document\n---\n\n\n::: callout-important\nThis application exercise is due on 16 Sept at 2:00pm.\n:::\n\n# Load packages, data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## loading libraries\nlibrary(tidyverse) # for data analysis and visualisation\nlibrary(here) # to organize files\nlibrary(praise) # for ocassional good vibes!\n```\n:::\n\n\nLet's look at the data [on the web](https://github.com/cosmoduende/r-marvel-vs-dc/blob/main/dataset_shdb/heroesInformation.csv) prior to importing it and also to ensure that we know what it should look like when it is imported into R.\n\nNow press \"raw\"\n\n![](ae-2_images/click_raw.png)\n\nThen copy the url:\n\n![](ae-2_images/copy_url.png)\n\nDownload the file by inserting the URL below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfs::dir_create(here(\"data\")) # create a data folder \ndownload.file(\n  url = URL_HERE, # url of file to download\n  destfile = here(\"data/comics.csv\") # directory/name_of_file\n)\n```\n:::\n\n\nThen click on the data folder in the \"Files\" panel.\n\n![](ae-2_images/data_folder.png)\n\nDouble click on \"comics.csv\" and click on \"Import Dataset...\"\n\n![](ae-2_images/import_dataset.png)\n\nCheck the data in the \"Data Preview\" pane and ensure that it looks as it should.\n\n![](ae-2_images/import_GUI.png)\n\nNext, click on the clipboard icon to copy the code from the \"Code Preview\" pane, then click \"Import\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#PASTE THE CODE FROM \"Code Preview\" HERE\n```\n:::\n\n\n# Data\n\nThe `comics` dataset includes basic information scraped from the [superheroDb](https://www.superherodb.com/) for a [kaggle](https://www.kaggle.com/) competition.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## An overview of the dataset and type of variables\nglimpse(comics)\n```\n:::\n\n\nThe first superhero is named \"A-Bomb\" he is male, with yellow eyes, human, with no hair. Marvel Comics created him and his skin color is not listed, but his height and weight are.\n\n1.  Are there any differences between the data on the website above and the one in R? What are they? (Hint: which function can you use to see the whole dataset?)\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    praise()\n    ```\n    :::\n\n\n2.  The \\_\\_\\_ dataset has \\_\\_\\_ observations and \\_\\_\\_ variables.\n\n3.  Classify all variables in the dataset as either: quantitative discrete, quantitative continuous, qualitative nominal, qualitative ordinal. Which of these variables is also categorical?\n\n# Counts\n\n4.  How many publishers are there in this dataset?\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% \n      distinct(Publisher) # finds the levels of publisher\n    ```\n    :::\n\n\n5.  How many levels of the variable Alignment are there in this dataset?\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% \n      INSERT_FUNCTION(INSERT_VARIABLE)\n    ```\n    :::\n\n\nA common way to represent the number of cases that fall into each combination of levels of two categorical variables, such as these, is with what's called a \"contingency table.\" Note that each superhero appears in **exactly one cell, s**tatisticians call this **mutually exclusive.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\npraise()\n```\n:::\n\n\n6.  Which is the most common category in this contingency table? How many superheros are in that category? (note: please look at both of the next two blocks of code.)\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% \n      count(Publisher, Alignment) %>% # counts all combinations\n      View()\n    ```\n    :::\n\n\nThe long format above is difficult to see clearly. The format we normally use for contingency tables is the wide format.\n\nThe third line of coding below takes a long table and makes it wide by moving the `Alignment` variable to the columns, and filling the values of the table with the count variable (`n`). The `names_from` argument tells R where the names of the new columns are coming from (i.e. what variable), and the `values_from` argument tells `R` where the values in the table are coming from. Here, the values we want in our table are stored as a variable labeled `n` in our table.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomics %>% \n  count(Publisher, Alignment) %>%  # counts all combinations\n  pivot_wider(names_from = Alignment, \n              values_from = n) # pivots from long to wide \n```\n:::\n\n\n7.  There are about \\_\\_\\_ good superheros for each bad superhero.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(data = comics) + # the dataset\n      geom_bar(mapping = aes(x = Alignment)) # a bar chart of Alignment\n    ```\n    :::\n\n\n8.  Look at the next two plots and find the difference between them. What would make you use one plot over the other? Which plot shows that females are much more likely to be good superheros than bad? Which one shows that good superheros are more likely to be missing gender? And which that females are more likely to be good superheros than males? All of these mean that the variables gender and alignment are **associated**, the value of one impacts upon the value of the other.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(data = comics) + # add the data\n      geom_bar(mapping = aes(x = Gender, # bar chart of gender\n                             fill = Alignment)) +  # colored by alignment\n      labs(title = \"Gender colored with alignment\") # add title\n    ```\n    :::\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(data = comics) + # add the data\n      geom_bar(mapping = aes(x = Alignment, # bar chart of alignment\n                             fill = Gender)) + # colored by gender\n      labs(title = \"Alignment colored with gender\")  # add title\n    ```\n    :::\n\n\nWe note that the commonly held belief that gender is binary is no longer the scientific consensus and that gender is a complex spectrum.\n\n![](ae-2_images/beyondXX_XY.webp)\n\nStatisticians want to discuss the **strength of association** of variables. They want to ensure that this association is not the result of random noise, but instead is a function of the underlying population of interest (all superheros).\n\n\n::: {.cell}\n\n```{.r .cell-code}\npraise()\n```\n:::\n\n\n# Chi-Squared test\n\nTo test for independence in 2 categorical variables, statisticians use a **Chi-squared test**. This is a **hypothesis test** so it has both a null hypothesis ($H_0$) and an alternative hypothesis ($H_A$).\n\n$H_0$ = the variables are independent, there is **no** relationship between the two categorical variables.\n\n$H_A$ = Knowing the value of one variable helps to predict the value of the other variable\n\nJust like a fair court case, where a defendant is assumed to be innocent until proven guilty, here we assume $H_0$ until proven otherwise. The proof that we present at the case is a formula relating the actual values in our sample to what we would expect to get under the independence assumption.\n\nTo perform a Chi-squared test of independence on gender and alignment we must find the marginal distributions of both gender and alignment.\n\n# Marginal distribution\n\n9.  The marginal distribution is the count of each variable.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% \n      count(Alignment, Gender) %>% \n      pivot_wider(names_from = Alignment, \n                  values_from = n)\n    ```\n    :::\n\n\nWe take the original two-way table (with two categorical variables) and added up the cells across each level of `align` (ie $1+7+19+2 = 29$) to get the marginal distribution for each variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomics %>% # the dataset\n  count(Gender) # and marginal distribution of gender\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npraise()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncomics %>% # the dataset\n  count(Alignment) # and marginal distribution of the Alignment\n```\n:::\n\n\nIf these are independent, we would expect $\\frac{200}{29+200+505}$ of the $207$ (about $56.4$) bad superheros to be female, and the same proportion of $496$ (about $135.1$) good superheros to be female, and so on.\n\n10. Assuming independence of Alignment and Gender, how many good superheros would we expect to be male? (hint: use the \"\\$\\frac{1}{2}\\$\" to make$\\frac{1}{2}$)\n\nMore information, including mathematical notation can be found [here](https://statsandr.com/blog/chi-square-test-of-independence-by-hand/).\n\nFortunately, \\`R\\` does all of this for us.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# the \"$\" sign pulls out the Gender values and Alignment value from the comics dataset\nchisq.test(comics$Gender, comics$Alignment)\n```\n:::\n\n\nWe get a warning because the missing values (\"-\") expected counts are probably quite small. You can safely use the chi-square test with critical values from the chi-square distribution when no more than 20% of the expected counts are less than $5$ and all individual expected counts are 1 or greater. In particular, all four expected counts in a $2 \\times 2$ table should be 5 or greater.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npraise()\n```\n:::\n\n\nThe $p-value$ for this test $0.0003298$ is very small which means that we have very strong evidence against $H_0$ --- that there is independence between Alignment and Gender --- and we can reject the null hypothesis. This suggests that the association between Gender and Alignment is not likely due to chance.\n\n11. There are a few characters with missing data \"-\" in the Alignment and Gender variables? How many are in each?\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% \n      INSERT_FUNCTION(INSERT_VARIABLE)\n    ```\n    :::\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% \n      INSERT_FUNCTION(INSERT_VARIABLE)\n    ```\n    :::\n\n\n12. Since there are only a few missing values (\\<10%) in each category, there is no reason to keep them especially since our analysis is largely about these two variables.\n\n    What does the \"!=\" operator do?\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics_filtered <- # assign a name to a new dataset\n      comics %>% # tell R which dataset to start with\n      INSERT_FUNCTION(Alignment != \"-\", # remove \"-\" values in Alignment\n                      Gender != \"-\") # remove \"-\" values in Gender\n    ```\n    :::\n\n\n13. Remake the \"Alignment colored with gender\" plot and the \"Gender colored with alignment\" plots with this new dataset.\n\n14. Redo the Chi-Squared test for independence between Alignement and Gender. Include all hypotheses, and computations for at least $2$ expected values. Does this change our conclusion?\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    praise()\n    ```\n    :::\n\n\n15. Side-by-side barcharts allow us to represent the counts from a contingency table graphically. Telling `R` to make a side-by-side barchart involves adding the words `position = \"dodge`\" to the coding from above. Now created the other bar chart side-by-side, the \"Gender colored with alignment.\" use the comics_filter dataset.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(data = INSERT) + # add the data\n      geom_bar(mapping = aes(x = INSERT, # bar chart of alignment\n                             fill = INSERT), # colored by gender\n               position = INSERT) + # side_by_side\n      labs(title = \"Alignment colored with gender\")  # add title\n    ```\n    :::\n\n\n# Proportions\n\nWe have been focusing mostly on counts. Proportional data is also interesting to explore and it is easy to get `R` to produce those for us.\n\n16. What combination of Gender and Alignment has the highest proportion? What is the value? What is the sum of all of the proportions in the table below? (Note: Use the View() function to go through each line of code and ensure you know what each step does.)\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% # which dataset to use \n      count(Gender, Alignment) %>% # counts all combinations\n      mutate(prop = n / sum(n)) %>% # finds proportions\n      select(Gender, Alignment, prop) %>% # selecting which cols to pivot\n      pivot_wider(names_from = Alignment, # the variable to pivot\n                  values_from = prop) # which values to pivot\n    ```\n    :::\n\n\n# Conditional proportions\n\n17. If we're curious about systematic associations between variables, we should look to conditional proportions. An example of a conditional proportion is the proportion of female superheroes that are good. To build a table of these conditional proportions, we need to specify a grouping variable **before** we calculate the proportions. What proportion of female characters are good? What do the rows sum to? (Note: Use the View() function to go through each line of code and ensure you know what each step does.)\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% # which dataset to use \n      count(Gender, Alignment) %>% # counts all combinations\n      group_by(Gender) %>% # conditions on gender\n      mutate(prop = n / sum(n)) %>% # finds proportions\n      select(Gender, Alignment, prop) %>%  # selecting which cols to pivot\n      pivot_wider(names_from = Alignment, # the variable to pivot\n                  values_from = prop) # which values to pivot\n    ```\n    :::\n\n\n18. What proportion of good characters are male? What do the columns sum to?\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    comics %>% # which dataset to use \n      count(Gender, Alignment) %>% # counts all combinations\n      group_by(Alignment) %>% # conditions on gender\n      mutate(prop = n / sum(n)) %>% # finds proportions\n      select(Gender, Alignment, prop) %>%  # selecting which cols to pivot\n      pivot_wider(names_from = Alignment, # the variable to pivot\n                  values_from = prop) # which values to pivot\n    ```\n    :::\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    praise()\n    ```\n    :::\n\n\n19. Plotting proportions is similar to the side-by-side bar chart completed earlier. Instead of `position = \"dodge\"` we use `position = \"fill\"` . Draw one such plot below using Gender for the `x` axis and color it using Alignment.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(data = INSERT) + # add the data\n      geom_bar(mapping = aes(x = INSERT, # bar chart of ?\n                             fill = INSERT), # colored by ?\n               position = INSERT) # fill\n    ```\n    :::\n\n\n20. Now, change the label of the `y` axis from `count` by including the coding\n\n        labs(y = \"Proportion of superheroes\")\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    praise()\n    ```\n    :::\n\n\n21. Does the above plot condition on gender or alignment? How do you know? (hint: what sums to 1?)\n\n22. Condition on the other variable.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(data = INSERT) + # add the data\n      geom_bar(mapping = aes(x = INSERT, # bar chart of ?\n                             fill = INSERT), # colored by ?\n               position = INSERT)  + # fill\n      lab(y = \"INSERT Y AXIS TITLE HERE\")\n    ```\n    :::\n\n\n23. Another way to view the differences in variables is to facet. What is the advantage of a facet plot over a stacked barchart?\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(comics) + # which dataset\n      geom_bar(mapping = aes(x = Gender)) + # bar chart of Gender\n      facet_wrap(~Alignment) # broken down by Alignment\n    ```\n    :::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}