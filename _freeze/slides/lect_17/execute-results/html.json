{
  "hash": "b1a7414d42b3ddb0838fa69c68f2858c",
  "result": {
    "markdown": "---\ntitle: \"Chapter 18: Inference for counts\"\nsubtitle: \"STAT 1010 - Fall 2022\"\nfooter:  \"[stat1010-f22.github.io/website](https://stats1010-f22.github.io/website/)\"\nformat: \n  revealjs: \n    theme: slides.scss\n    transition: fade\n    slide-number: true\neditor: visual\nexecute:\n  freeze: auto\n---\n\n\n\n\n# Learning outcomes\n\n::: incremental\n-   Test for independence in a contigency table using a chi-squared test\n-   Check for a goodness of fit of a probability model using a chi-square test\n-   Find the appropriate degrees of freedom for a chi-squared test.\n-   Explain the similarities and differences between chi-squared tests and methods that compare two proportions\n-   Determine the statistical significance of a chi-squared statistic from `R`\n:::\n\n## Revision\n\nWe have [discussed](https://stats1010-f22.github.io/website/supplemental/chi-squared.html) [this](https://stats1010-f22.github.io/website/ae/ae-2-exploring-categorical-vars.html#chi-squared-test) [before](https://stats1010-f22.github.io/website/hw/hw-1.html) and now we will formalize this work. Like walking up a lighthouse.\n\n## Test of independence\n\n$$H_0: \\text{Qualitative variable 1 and Qualitative variable 2 are independent}$$\n\n$$H_A: \\text{Qualitative variable 1 and Qualitative variable 2 are not independent}$$\n\n## Example 1 {.smaller}\n\nA manufacturing firm is considering a shift from a 5-day workweek (8 hours per day) to a 4-day workweek (10 hours per day). Samples of the preferences of 188 employees in two divisions produced the following contingency table:\n\nObserved counts\n\n|             |       | Divisions |            |       |\n|-------------|-------|-----------|------------|-------|\n|             |       | Clerical  | Production | Total |\n| Preferences | 5-day | 17        | 46         | 63    |\n|             | 4-day | 28        | 38         | 66    |\n|             | Total | 45        | 84         | 129   |\n\na\\. What would it mean if the preference of employees is independent of division?\n\nb\\. State $H_0$ for the $\\chi^2$ test of independence in terms of the parameters of two segments of the population of employees.\n\n## Example 1 - solns\n\na.  Independence means that all the percent of people who prefer a 5-day work week is the same in all divisions. Lack of independence implies different percentages across divisions\nb.  $H_0: p_{clerical} = p_{production}$ $H_A: \\text{at least one of these differs}$\n\n## Calculating $\\chi^2$\n\nIf one variable is independent of the other, then the variable should have the same proportion in each level as the totals have in each level.\n\nExpected counts\n\n|             |       | Divisions                  |                            |       |\n|---------------|---------------|---------------|---------------|---------------|\n|             |       | Clerical                   | Production                 | Total |\n| Preferences | 5-day | $45/129\\cdot63 \\approx 22$ | $84/129\\cdot63 \\approx 41$ | 63    |\n|             | 4-day | $45/129\\cdot66 \\approx 23$ | $84/129\\cdot66 \\approx 43$ | 66    |\n|             | Total | 45                         | 84                         | 129   |\n\n## Calculating $\\chi^2$\n\n$$ \\chi^2 = sum\\frac{(observed - expected)^2}{expected}$$\n\nWe want to know how much this varies from the *expected* that is why the *expected* is the denominator.\n\n## Example 2\n\nFind the expected counts for the following observed variables\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> gender </th>\n   <th style=\"text-align:right;\"> happy </th>\n   <th style=\"text-align:right;\"> meh </th>\n   <th style=\"text-align:right;\"> sad </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 110 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:right;\"> 70 </td>\n   <td style=\"text-align:right;\"> 32 </td>\n   <td style=\"text-align:right;\"> 120 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Example 2 - solns\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> happy </th>\n   <th style=\"text-align:right;\"> meh </th>\n   <th style=\"text-align:right;\"> sad </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 88.31169 </td>\n   <td style=\"text-align:right;\"> 32.20779 </td>\n   <td style=\"text-align:right;\"> 119.4805 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 81.68831 </td>\n   <td style=\"text-align:right;\"> 29.79221 </td>\n   <td style=\"text-align:right;\"> 110.5195 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Plot\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ngender <- c(rep(\"male\", 222), \n            rep(\"female\", 240))\nmood <- c(rep(\"happy\", 70), rep(\"meh\",32),\n          rep(\"sad\", 120), rep(\"happy\", 100),\n          rep(\"meh\", 30), rep(\"sad\", 110))\nd <- tibble(gender, mood)\n \n## draw the plot\nggplot(data = d) +\n  geom_bar(aes(x = mood, fill = gender),\n           position = \"fill\")\n```\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](lect_17_files/figure-revealjs/plot-draw-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n## Reading plots\n\nIf the color change in the bars are approximately at the same height in every level of the variable on the $x$ axis, this is evidence against rejecting $H_0$. We might be more inclined to think that $H_0$ is true.\n\n## Assumptions\n\n1.  No lurking variables\n2.  Data is a random sample from the population\n3.  Categories must be mutually exclusive\n4.  Each cell count must be at least 5 or 10 (more [here](https://stats1010-f22.github.io/website/slides/lect_17.html#/degrees-of-freedom))\n\n#  {background-iframe=\"https://nzgwynn.shinyapps.io/chi-squared/\"}\n\n## degrees of freedom\n\n$$df \\text{ for a } \\chi^2 \\text{ test of independence} = (r-1)(c-1)$$\n\nwhere $r= \\text{number of rows}$ and $c= \\text{number of columns}$\n\nAssumptions:\n\n4.  Each cell count ideally 10, or 5 if the test has 4 or more degrees of freedom.\n\n## In `R`\n\n::: incremental\n1.  Find the totals\n2.  Compute the expected counts\n3.  Calculate $\\chi^2 = sum\\frac{(observed - expected)^2}{expected}$\n4.  Find the df $(r-1)(c-1)$\n5.  Solve for the p-value `1 - pchisq(chi-square, df)`\n:::\n\n## Example 3\n\nIn [example 2](https://stats1010-f22.github.io/website/slides/lect_17.html#/example-2), perform a hypothesis test and find the $\\chi^2$ value and the p-value. Are gender and mood independent?\n\n## Steps for a hypothesis test\n\n1.  State hypotheses\n2.  Determine the level of significance\n3.  Check conditions\n4.  Calculate test statistic\n5.  Compute p-value\n6.  Generic conclusion\n7.  Interpret in context\n\n## Example 3 - solns\n\n::: incremental\n1.  $H_0: p_h = p_m = p_s$ and $H_A: \\text{at least one differs}$\n2.  $\\alpha = 0.05$\n3.  [Yes](https://stats1010-f22.github.io/website/slides/lect_17.html#/example-2---solns).\n4.  $\\begin{aligned} \\chi^2 &= sum\\frac{(observed - expected)^2}{expected} \\\\ &= \\frac{(100-88.3)^2}{88.3} + \\frac{(70-81.7)^2}{81.7} + ... + \\frac{(120-119.5)^2}{119.5}\\\\ &\\approx 5.0999\\end{aligned}$ $df = (3-1)\\cdot(2-1)$\n:::\n\n## Example 3 - solns\n\n::: incremental\n5.  `1 - pchisq(5.099, df = 2)`$\\approx 0.078$\n6.  We fail to reject $H_0$\n7.  We do not have evidence that gender and mood are associated, the data suggests they are independent.\n:::\n\n## Example 3 - solns\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd %>% \n  count(mood, gender) %>% \n  pivot_wider(names_from = mood, values_from = n) %>% \n  select(-gender) %>% \n  chisq.test()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  .\nX-squared = 5.0999, df = 2, p-value = 0.07809\n```\n:::\n:::\n\n\n\n# General vs Specific Hypothesis\n\nThe $\\chi^2$ test is a general test that provides evidence that one of the proportions might differ. To estimate which proportion differs we will need to build a confidence intervals like we did [here](https://stats1010-f22.github.io/website/slides/lect_16.html#/two-sample-z-test-for-proportions).\n\n# Tests for randomness\n\nThere are a few places where $\\chi^2$ tests are particularly useful. For example, in fraud detection. [Benford's law](https://en.wikipedia.org/wiki/Benford%27s_law) outlines the frequency of first digits (1-9) in a number. If the proportions are significantly different than Benford's law there may be evidence of fraud.\n\n## Test for goodness of fit\n\nWhen an outcome is either Binomial or Poisson one way to check that predictions are correct is to perform a $\\chi^2$ test on the actual and predicted.\n\n::: incremental\n-  A small p-value to indicates that these values are *not* independent.\n:::\n\n# Your turn\n\n[Click here](https://stats1010-f22.github.io/website/ae/ae-12.html) or the qr code below\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lect_17_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n",
    "supporting": [
      "lect_17_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}